<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>√Åll√°shirdet√©s felt√∂lt√©se - WorkConnect</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="favicon.ico">
</head>

<body class="jobs-page">

 
    <div class="jobs-topbar">
        <div class="jobs-hamburger">‚ò∞</div>

        <div class="jobs-timer">
            <span class="timer-text">05:00</span>
        </div>

        <a href="profile.html" class="jobs-profile-circle"></a>
    </div>

  
    <div class="sidebar-menu">
        <button class="close-btn">√ó</button>
        <h3>Men√º</h3>
        <ul>
            <li><a href="jobs.html">F≈ëoldal</a></li>
            <li><a href="premium.html">Premium</a></li>
            <li><a href="profile.html">Profil</a></li>
            <li><a href="#">Be√°ll√≠t√°sok</a></li>
            <li><a href="#" id="logoutBtnSidebar">Kijelentkez√©s</a></li>
        </ul>
    </div>

  
    <div class="application-container">

        <a href="allashirdet.html" class="back-button">Vissza a vez√©rl≈ëpulthoz</a>

        <div class="application-header">
            <h1>√Åll√°shirdet√©s felt√∂lt√©se</h1>
            <p>Add meg az adatokat, √©s n√©zd meg el≈ën√©zetben.</p>
        </div>

        <div class="form-section job-upload-grid">

          
            <div class="job-upload-card">
                <h2>≈∞rlap</h2>

                <div class="field">
                    <label class="required" for="companyName">C√©g neve:</label>
                    <input id="companyName" type="text" placeholder="Pl. WorkConnect Kft." />
                    <small class="error-message"></small>
                </div>

                <div class="field">
                    <label class="required" for="jobPosition">Poz√≠ci√≥ neve:</label>
                    <input id="jobPosition" type="text" placeholder="Pl. Rakt√°ros" />
                    <small class="error-message"></small>
                </div>

                <div class="field">
                    <label class="required" for="jobLocation">Helysz√≠n:</label>
                    <input id="jobLocation" type="text" placeholder="Pl. Budapest" />
                    <small class="error-message"></small>
                </div>

                <div class="field job-upload-file">
                    <label for="jobImage">K√©p (opcion√°lis):</label>
                    <input id="jobImage" type="file" accept="image/*" />
                    <small>Aj√°nlott: 1:1 ar√°ny, max 5MB</small>
                </div>

                <button class="apply-submit-btn" id="submitJobBtn">
                    Hirdet√©s felad√°sa
                </button>
            </div>

     
            <div class="job-upload-card preview-card">
                <h2>El≈ën√©zet</h2>

                <div class="job-preview-box">
                    <div id="previewText"></div>
                    <img id="imgPreview" style="display:none;" />
                </div>

                <div class="job-preview-hint">
                    <p>
                        Ez az el≈ën√©zet azt mutatja, hogyan fog megjelenni az √°ll√°s az √°ll√°slist√°ban.
                    </p>
                </div>
            </div>

        </div>
    </div>

  
    <div id="successPopup" class="popup">
        <div class="popup-content">
            <h3>Sikeresen felt√∂ltve! üéâ</h3>
            <p>Az √°ll√°shirdet√©s beker√ºlt a list√°ba.</p>
            <button onclick="closePopup()" class="buy-btn">Rendben</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

        
            const isLoggedIn = () => localStorage.getItem('currentUser') !== null;

            if (!isLoggedIn()) {
                window.location.href = 'index.html';
                return;
            }

         
            const profileCircle = document.querySelector('.jobs-profile-circle');
            if (profileCircle) {
                const username = localStorage.getItem('currentUser');
                if (username) {
                    profileCircle.style.background = '#35bd5b';
                    profileCircle.style.color = 'white';
                    profileCircle.textContent = username.charAt(0).toUpperCase();
                    profileCircle.title = `${username} - Profil`;
                }
            }

            
            const hamburger = document.querySelector('.jobs-hamburger');
            const sidebar = document.querySelector('.sidebar-menu');
            const closeBtn = document.querySelector('.close-btn');

            if (hamburger && sidebar) {
                hamburger.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    sidebar.classList.toggle('open');
                });

                if (closeBtn) {
                    closeBtn.addEventListener('click', function () {
                        sidebar.classList.remove('open');
                    });
                }

                document.addEventListener('click', function (e) {
                    if (sidebar.classList.contains('open')) {
                        if (!sidebar.contains(e.target) && !hamburger.contains(e.target)) {
                            sidebar.classList.remove('open');
                        }
                    }
                });
            }

        
            const logoutBtnSidebar = document.getElementById('logoutBtnSidebar');
            if (logoutBtnSidebar) {
                logoutBtnSidebar.addEventListener('click', function (e) {
                    e.preventDefault();
                    if (confirm('Biztosan ki szeretne jelentkezni?')) {
                        localStorage.removeItem('currentUser');
                        localStorage.removeItem('userType');
                        window.location.href = 'index.html';
                    }
                });
            }

    
            let timerInterval = null;
            let timeLeft = 300;

            function startTimer() {
                const timerElement = document.querySelector('.jobs-timer');
                if (!timerElement) return;

                const textElement = timerElement.querySelector('.timer-text') || timerElement;

                if (timerInterval) clearInterval(timerInterval);

                timerInterval = setInterval(() => {
                    timeLeft--;

                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;

                    textElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        localStorage.removeItem('currentUser');
                        localStorage.removeItem('userType');
                        window.location.href = 'index.html';
                    }
                }, 1000);
            }

            startTimer();

            const timerElement = document.querySelector('.jobs-timer');
            if (timerElement) {
                timerElement.addEventListener('click', function () {
                    timeLeft = 300;
                    startTimer();
                });
            }

      

            const companyName = document.getElementById("companyName");
            const jobPosition = document.getElementById("jobPosition");
            const jobLocation = document.getElementById("jobLocation");
            const jobImage = document.getElementById("jobImage");

            const previewText = document.getElementById("previewText");
            const imgPreview = document.getElementById("imgPreview");

            const submitBtn = document.getElementById("submitJobBtn");
            const successPopup = document.getElementById("successPopup");

            function updatePreview() {
                previewText.innerHTML = `
                    <p><b>C√©g:</b> ${companyName.value || "-"}</p>
                    <p><b>Poz√≠ci√≥:</b> ${jobPosition.value || "-"}</p>
                    <p><b>Helysz√≠n:</b> ${jobLocation.value || "-"}</p>
                `;
            }

            companyName.addEventListener("input", updatePreview);
            jobPosition.addEventListener("input", updatePreview);
            jobLocation.addEventListener("input", updatePreview);

            jobImage.addEventListener("change", () => {
                const file = jobImage.files[0];
                if (!file) return;

                // (Opcion√°lis) m√©ret limit
                if (file.size > 5 * 1024 * 1024) {
                    alert("A k√©p t√∫l nagy! Maximum 5MB lehet.");
                    jobImage.value = "";
                    imgPreview.style.display = "none";
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    imgPreview.src = e.target.result;
                    imgPreview.style.display = "block";
                };
                reader.readAsDataURL(file);
            });

            updatePreview();

            function clearErrors() {
                document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
            }

            function submitJob() {
                clearErrors();

                let ok = true;

                if (!companyName.value.trim()) {
                    companyName.nextElementSibling.textContent = "K√∂telez≈ë mez≈ë!";
                    ok = false;
                }

                if (!jobPosition.value.trim()) {
                    jobPosition.nextElementSibling.textContent = "K√∂telez≈ë mez≈ë!";
                    ok = false;
                }

                if (!jobLocation.value.trim()) {
                    jobLocation.nextElementSibling.textContent = "K√∂telez≈ë mez≈ë!";
                    ok = false;
                }

                if (!ok) return;

                const jobData = {
                    id: Date.now(),
                    company: companyName.value.trim(),
                    position: jobPosition.value.trim(),
                    location: jobLocation.value.trim(),
                    image: imgPreview.src || null
                };

                const jobs = JSON.parse(localStorage.getItem("jobs")) || [];
                jobs.push(jobData);
                localStorage.setItem("jobs", JSON.stringify(jobs));

                successPopup.classList.add("show");

                setTimeout(() => {
                    successPopup.classList.remove("show");
                    window.location.href = "allashirdet.html";
                }, 1800);
            }

            submitBtn.addEventListener("click", submitJob);
        });

        function closePopup() {
            document.getElementById('successPopup').classList.remove('show');
        }
    </script>

</body>
</html>
